<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chemistry Quiz Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Hide answers by default and reveal them when the `.show` class is toggled */
      .answer {
        display: none;
      }
      .answer.show {
        display: block;
      }
      /* Smooth dropdown animation */
      .dropdown-enter {
        transform: scaleY(0);
        transform-origin: top;
        transition: transform 0.15s ease-out;
      }
      .dropdown-enter-active {
        transform: scaleY(1);
      }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Main wrapper at 70% width with 15% side margins -->
  <div class="mx-auto w-[70%] px-4 py-8 max-w-none">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-bold text-indigo-800 mb-2">
        Chemistry Quiz Master
      </h1>
      <p class="text-lg text-gray-600">
        Test your chemistry knowledge with interactive questions
      </p>
    </header>

    <!-- ---------------------- FILTERS ---------------------- -->
    <div id="filterSection" class="bg-white p-6 rounded-xl shadow-md mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Filter Questions</h2>

      <div class="flex flex-wrap gap-4 mb-4">
        <!-- Include categories (Multi‑Select Checkbox Dropdown) -->
        <div class="relative w-52">
          <span class="block text-sm font-medium text-gray-700 mb-1"
            >Choose category</span
          >
          <button
            id="includeToggle"
            type="button"
            class="multiselect-btn w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-left truncate focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >
            -- none --
          </button>

          <!-- Options list -->
          <div
            id="includeOptions"
            class="multiselect-options hidden absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"
          ></div>
        </div>

        <!-- Exclude categories (Multi‑Select Checkbox Dropdown) -->
        <div class="relative w-52">
          <span class="block text-sm font-medium text-gray-700 mb-1"
            >Exclude category</span
          >
          <button
            id="excludeToggle"
            type="button"
            class="multiselect-btn w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-left truncate focus:outline-none focus:ring-2 focus:ring-indigo-500"
          >
            -- none --
          </button>

          <!-- Options list -->
          <div
            id="excludeOptions"
            class="multiselect-options hidden absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto"
          ></div>
        </div>

        <!-- Max questions -->
        <div>
          <label
            for="maxQuestions"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Max Questions</label
          >
          <input
            type="number"
            id="maxQuestions"
            min="1"
            value="10"
            class="w-24 px-3 py-2 border border-gray-300 rounded-md"
          />
        </div>

        <!-- Random order -->
        <div class="flex items-end mb-1">
          <input
            type="checkbox"
            id="randomOrder"
            class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
          />
          <label for="randomOrder" class="ml-2 text-sm font-medium text-gray-700"
            >Random order</label
          >
        </div>
      </div>

      <!-- Search -->
      <div class="flex items-center">
        <input
          type="text"
          id="searchInput"
          placeholder="Search questions..."
          class="flex-grow px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
        />
        <button
          id="searchBtn"
          class="bg-indigo-600 text-white px-4 py-2 rounded-r-lg hover:bg-indigo-700 transition"
        >
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>

    <!-- ---------------------- QUESTIONS GRID ---------------------- -->
    <div
      id="questionsContainer"
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
    ></div>
    <div id="noResults" class="text-center py-12 hidden">
      <i class="fas fa-flask text-5xl text-gray-300 mb-4"></i>
      <h3 class="text-xl font-medium text-gray-500">
        No questions found. Select filters to begin.
      </h3>
    </div>
  </div>

  <!-- XLSX library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    /******************** DOM ELEMENTS *************************/
    const questionsContainer = document.getElementById("questionsContainer");
    const noResults = document.getElementById("noResults");
    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const maxQuestionsInput = document.getElementById("maxQuestions");
    const randomOrderCheckbox = document.getElementById("randomOrder");

    // Multi‑select elements
    const includeToggle = document.getElementById("includeToggle");
    const includeOptions = document.getElementById("includeOptions");
    const excludeToggle = document.getElementById("excludeToggle");
    const excludeOptions = document.getElementById("excludeOptions");

    /******************** STATE *************************/
    let allQuestions = [];
    let currentFilter = {
      include: [],
      exclude: [],
      searchTerm: "",
      max: 10,
      random: false,
    };

    /******************** HELPERS *************************/
    /** Update button label with selected items or placeholder */
    function updateButtonLabel(btn, list, placeholder) {
      btn.textContent = list.length ? list.join(", ") : `-- ${placeholder} --`;
    }

    /** Build a dropdown with checkbox items */
    function buildDropdown(toggleBtn, optionsDiv, categories, filterKey, placeholder) {
      // Clear previous
      optionsDiv.innerHTML = "";

      categories.forEach((cat) => {
        const label = document.createElement("label");
        label.className =
          "flex items-center px-2 py-1 cursor-pointer hover:bg-gray-100 text-sm";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = cat;
        checkbox.className = "mr-2 h-4 w-4 text-indigo-600 cursor-pointer";
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(cat));
        optionsDiv.appendChild(label);

        checkbox.addEventListener("change", () => {
          const selected = Array.from(
            optionsDiv.querySelectorAll("input:checked")
          ).map((i) => i.value);

          currentFilter[filterKey] = selected;
          updateButtonLabel(toggleBtn, selected, placeholder);
          renderQuestions();
        });
      });

      // Toggle dropdown visibility
      toggleBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        optionsDiv.classList.toggle("hidden");
      });
    }

    /** Close dropdowns when clicking outside */
    document.addEventListener("click", () => {
      includeOptions.classList.add("hidden");
      excludeOptions.classList.add("hidden");
    });

    /** Durstenfeld shuffle */
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    /******************** RENDER QUESTIONS *************************/
    function renderQuestions() {
      questionsContainer.innerHTML = "";

      let filtered = allQuestions.filter((q) => {
        const hasInclude =
          currentFilter.include.length === 0 ||
          q.categories.some((cat) => currentFilter.include.includes(cat));
        const noExclude = q.categories.every(
          (cat) => !currentFilter.exclude.includes(cat)
        );
        const matchSearch =
          !currentFilter.searchTerm ||
          q.question.toLowerCase().includes(currentFilter.searchTerm) ||
          q.answer.toLowerCase().includes(currentFilter.searchTerm);
        return hasInclude && noExclude && matchSearch;
      });

      // Randomize order if checkbox checked
      if (currentFilter.random) {
        filtered = shuffleArray(filtered);
      }

      // Apply max limit
      filtered = filtered.slice(0, currentFilter.max);

      if (filtered.length === 0) {
        noResults.classList.remove("hidden");
        return;
      } else {
        noResults.classList.add("hidden");
      }

      filtered.forEach((q) => {
        const el = document.createElement("div");
        el.className = "question-card bg-white rounded-xl shadow-md overflow-hidden";
        el.id = `question-${q.id}`;
        el.innerHTML = `
          <div class="p-6">
            <div class="mb-4">
              ${q.categories
                .map(
                  (cat) =>
                    `<span class="px-3 py-1 bg-gray-100 text-gray-800 text-xs font-semibold rounded-full mr-1">${cat}</span>`
                )
                .join("")}
            </div>
            <h3 class="text-lg font-medium text-gray-800 mb-4">${q.question}</h3>
            <div class="answer" id="answer-${q.id}">
              <div class="bg-gray-50 p-4 rounded-lg">
                <h4 class="text-sm font-semibold text-gray-500 mb-2">Answer:</h4>
                <p class="text-gray-700">${q.answer}</p>
              </div>
            </div>
            <button onclick="toggleAnswer(${q.id})" class="toggle-btn mt-4 w-full flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition">
              <span class="mr-2">Show Answer</span>
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>`;
        questionsContainer.appendChild(el);
      });
    }

    /******************** TOGGLE ANSWER *************************/
    function toggleAnswer(id) {
      const answer = document.getElementById(`answer-${id}`);
      const button = answer.parentElement.querySelector(".toggle-btn");
      answer.classList.toggle("show");
      button.innerHTML = answer.classList.contains("show")
        ? '<span class="mr-2">Hide Answer</span><i class="fas fa-chevron-up"></i>'
        : '<span class="mr-2">Show Answer</span><i class="fas fa-chevron-down"></i>';
      button.classList.toggle("bg-indigo-800");
      button.classList.toggle("bg-indigo-600");
    }

    /******************** EVENT LISTENERS *************************/
    searchBtn.addEventListener("click", () => {
      currentFilter.searchTerm = searchInput.value.trim().toLowerCase();
      renderQuestions();
    });

    searchInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") {
        currentFilter.searchTerm = searchInput.value.trim().
